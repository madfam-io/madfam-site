# Development Dockerfile
FROM node:20-alpine AS base
RUN apk add --no-cache libc6-compat openssl
RUN corepack enable && corepack prepare pnpm@latest --activate
WORKDIR /app

# Copy package files and configs
COPY package.json pnpm-lock.yaml pnpm-workspace.yaml tsconfig.json ./
COPY packages/ ./packages/
COPY apps/ ./apps/

# Install dependencies with shamefully-hoist for better module resolution
RUN pnpm install --shamefully-hoist

WORKDIR /app/apps/web

# Generate Prisma client if schema exists
RUN npx prisma generate || true

EXPOSE 3000
ENV PORT=3000
ENV HOSTNAME="0.0.0.0"

CMD ["pnpm", "dev"]
